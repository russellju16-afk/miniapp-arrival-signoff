<view class="container safe-bottom mine-page page-shell">
  <view class="mine-header">
    <view class="header-icons">
      <view class="header-icon">
        <image class="header-icon-img" src="../../assets/icons/mine/menu.png" mode="aspectFit"></image>
      </view>
      <view class="header-icon">
        <image class="header-icon-img" src="../../assets/icons/mine/apps.png" mode="aspectFit"></image>
      </view>
    </view>
    <view class="header-action">
      <view class="action-dot"></view>
      <view class="action-dot"></view>
      <view class="action-dot"></view>
    </view>
    <view class="profile-row">
      <view class="avatar-circle">
        <image class="avatar-img" src="../../assets/icons/mine/avatar.png" mode="aspectFit"></image>
      </view>
      <view class="profile-main">
        <view class="profile-name">{{(profile && profile.name) || '我的账号'}}</view>
        <view class="profile-company">{{(profile && profile.companyName) || '-'}}</view>
      </view>
    </view>
  </view>

  <block wx:if="{{loading && !profile}}">
    <view class="card status-card">
      <view class="empty-state">
        <view class="empty-illustration">
          <image class="empty-illustration-img" src="../../assets/icons/mine/loading.png" mode="aspectFit"></image>
        </view>
        <view class="empty-title">账号信息加载中</view>
        <view class="empty-desc">正在同步企业资料与权限配置</view>
      </view>
    </view>
  </block>

  <block wx:elif="{{errorMessage && !profile}}">
    <view class="card status-card">
      <view class="empty-state">
        <view class="empty-illustration">
          <image class="empty-illustration-img" src="../../assets/icons/mine/warning.png" mode="aspectFit"></image>
        </view>
        <view class="empty-title">加载失败</view>
        <view class="empty-desc">{{errorMessage}}</view>
        <button class="btn-primary" bindtap="refreshData" disabled="{{loading}}">重试</button>
      </view>
    </view>
  </block>

  <view wx:if="{{errorMessage && profile}}" class="sync-tip">
    最近同步失败：{{errorMessage}}
  </view>

  <view class="notice-row">
    <view class="notice-text">金蝶客户：{{(profile && profile.kingdeeCustomerId) || '未绑定'}}</view>
  </view>

  <view class="menu-card">
    <view class="card-title">业务能力</view>
    <view class="menu-grid four-cols">
      <view class="menu-item capability-item">
        <view class="menu-icon">
          <image class="menu-icon-img" src="../../assets/icons/mine/order.png" mode="aspectFit"></image>
        </view>
        <view class="menu-title">下单</view>
        <view class="{{capabilities && capabilities.canCreateOrder ? 'capability-ok' : 'capability-off'}}">
          {{capabilities && capabilities.canCreateOrder ? '可用' : '不可用'}}
        </view>
      </view>
      <view class="menu-item capability-item">
        <view class="menu-icon">
          <image class="menu-icon-img" src="../../assets/icons/mine/statement.png" mode="aspectFit"></image>
        </view>
        <view class="menu-title">对账</view>
        <view class="{{capabilities && capabilities.canViewStatements ? 'capability-ok' : 'capability-off'}}">
          {{capabilities && capabilities.canViewStatements ? '可用' : '不可用'}}
        </view>
      </view>
      <view class="menu-item capability-item">
        <view class="menu-icon">
          <image class="menu-icon-img" src="../../assets/icons/mine/invoice.png" mode="aspectFit"></image>
        </view>
        <view class="menu-title">开票</view>
        <view class="{{capabilities && capabilities.canUseInvoiceCenter ? 'capability-ok' : 'capability-off'}}">
          {{capabilities && capabilities.canUseInvoiceCenter ? '可用' : '不可用'}}
        </view>
      </view>
      <view class="menu-item capability-item">
        <view class="menu-icon">
          <image class="menu-icon-img" src="../../assets/icons/mine/quote.png" mode="aspectFit"></image>
        </view>
        <view class="menu-title">报价</view>
        <view class="{{capabilities && capabilities.canSubmitQuote ? 'capability-ok' : 'capability-off'}}">
          {{capabilities && capabilities.canSubmitQuote ? '可用' : '不可用'}}
        </view>
      </view>
    </view>
  </view>

  <view class="menu-card">
    <view class="card-title">常用功能</view>
    <view class="menu-grid four-cols">
      <view class="menu-item" bindtap="handleMenuTap" data-action="quote">
        <view class="menu-icon">
          <image class="menu-icon-img" src="../../assets/icons/mine/quote.png" mode="aspectFit"></image>
        </view>
        <view class="menu-title">报价申请</view>
      </view>
      <view class="menu-item" bindtap="handleMenuTap" data-action="statements">
        <view class="menu-icon">
          <image class="menu-icon-img" src="../../assets/icons/mine/statement.png" mode="aspectFit"></image>
        </view>
        <view class="menu-title">对账中心</view>
      </view>
      <view class="menu-item" bindtap="handleMenuTap" data-action="invoiceRequest">
        <view class="menu-icon">
          <image class="menu-icon-img" src="../../assets/icons/mine/invoice.png" mode="aspectFit"></image>
        </view>
        <view class="menu-title">申请开票</view>
      </view>
      <view class="menu-item" bindtap="handleMenuTap" data-action="address">
        <view class="menu-icon">
          <image class="menu-icon-img" src="../../assets/icons/mine/address.png" mode="aspectFit"></image>
        </view>
        <view class="menu-title">收货地址</view>
      </view>
    </view>
  </view>

  <view class="menu-card">
    <view class="card-title">账户信息</view>
    <view class="menu-grid three-cols">
      <view class="menu-item metric-item">
        <view class="metric-value">{{(profile && profile.contactName) || '-'}}</view>
        <view class="menu-title">联系人</view>
      </view>
      <view class="menu-item metric-item">
        <view class="metric-value">{{(profile && profile.contactPhone) || '-'}}</view>
        <view class="menu-title">联系电话</view>
      </view>
      <view class="menu-item metric-item">
        <view class="metric-value">{{(profile && profile.status) || '-'}}</view>
        <view class="menu-title">账号状态</view>
      </view>
    </view>
  </view>

  <view class="menu-card services-card">
    <view class="card-title">更多服务</view>
    <view class="menu-grid four-cols">
      <view class="menu-item" bindtap="handleMenuTap" data-action="invoiceProfiles">
        <view class="menu-icon">
          <image class="menu-icon-img" src="../../assets/icons/mine/template.png" mode="aspectFit"></image>
        </view>
        <view class="menu-title">开票资料模板</view>
      </view>
      <view class="menu-item" bindtap="handleMenuTap" data-action="feedback">
        <view class="menu-icon">
          <image class="menu-icon-img" src="../../assets/icons/mine/feedback.png" mode="aspectFit"></image>
        </view>
        <view class="menu-title">问题反馈</view>
      </view>
      <view class="menu-item danger-item" bindtap="handleMenuTap" data-action="logout">
        <view class="menu-icon">
          <image class="menu-icon-img" src="../../assets/icons/mine/logout.png" mode="aspectFit"></image>
        </view>
        <view class="menu-title">退出登录</view>
      </view>
      <view class="menu-item">
        <view class="menu-icon">
          <image class="menu-icon-img" src="../../assets/icons/mine/version.png" mode="aspectFit"></image>
        </view>
        <view class="menu-title">{{version}}</view>
      </view>
    </view>
  </view>

  <view class="mine-footer">
    <view class="footer-line">到货签收与订货平台</view>
    <view class="footer-line">版本：{{version}}</view>
  </view>
</view>
