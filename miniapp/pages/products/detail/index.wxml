<view class="container">
  <block wx:if="{{loading}}">
    <view class="empty">加载中...</view>
  </block>

  <block wx:elif="{{!product}}">
    <view class="empty">商品不存在</view>
  </block>

  <block wx:else>
    <view class="card product-head">
      <view class="row">
        <view>
          <view class="title">{{product.name}}</view>
          <view class="sub-title">编码：{{product.code}}</view>
        </view>
        <view class="fav {{isFavorite ? 'fav-active' : ''}}" bindtap="toggleFavorite">
          {{isFavorite ? '已收藏' : '收藏'}}
        </view>
      </view>
      <view class="sub-title" wx:if="{{product.description}}">{{product.description}}</view>
      <view class="price-line">¥{{product.minPriceText}} 起</view>
    </view>

    <view class="card">
      <view class="title">规格选择</view>
      <block wx:if="{{product.skus.length === 0}}">
        <view class="sub-title">暂无可售规格</view>
      </block>
      <block wx:else>
        <view
          class="sku-row {{selectedSkuId === item.id ? 'sku-row-active' : ''}} {{item.status !== 'ACTIVE' ? 'sku-row-disabled' : ''}}"
          wx:for="{{product.skus}}"
          wx:key="id"
          data-id="{{item.id}}"
          bindtap="onSelectSku"
        >
          <view class="row">
            <text class="value">{{item.skuName}}</text>
            <text class="value">¥{{item.priceText}}</text>
          </view>
          <view class="sub-title">{{item.specsText || '标准规格'}} · 库存 {{item.stock}}</view>
        </view>
      </block>
    </view>

    <view class="card" wx:if="{{selectedSku}}">
      <view class="title">购买数量</view>
      <view class="qty-wrap">
        <button class="btn-plain qty-btn" bindtap="onMinusQty">-</button>
        <input class="qty-input" value="{{qty}}" type="number" bindinput="onQtyInput" />
        <button class="btn-plain qty-btn" bindtap="onPlusQty">+</button>
      </view>

      <view class="ops">
        <button class="btn-plain op-btn" bindtap="addToCart">加入购物车</button>
        <button class="btn-primary op-btn" bindtap="buyNow">立即购买</button>
      </view>
      <button class="btn-plain" bindtap="goCart">前往购物车</button>
      <button class="btn-plain" bindtap="goFavorites">查看收藏</button>
    </view>

    <view class="card">
      <view class="title">服务保障</view>
      <view class="service-item" wx:for="{{serviceItems}}" wx:key="*this">· {{item}}</view>
    </view>
  </block>
</view>
