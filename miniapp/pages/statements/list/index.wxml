<view class="container">
  <view class="card">
    <view class="title">筛选条件</view>
    <view class="row">
      <text class="label">开始日期</text>
      <picker mode="date" value="{{from}}" bindchange="onFromChange">
        <view class="picker-value">{{from}}</view>
      </picker>
    </view>
    <view class="row">
      <text class="label">结束日期</text>
      <picker mode="date" value="{{to}}" bindchange="onToChange">
        <view class="picker-value">{{to}}</view>
      </picker>
    </view>
    <view class="actions">
      <button class="btn-primary action-btn" bindtap="search" loading="{{loading}}" disabled="{{loading || actionLoading}}">查询</button>
      <button class="btn-plain action-btn" bindtap="goDeliveries" disabled="{{loading || actionLoading}}">返回签收列表</button>
    </view>
  </view>

  <block wx:if="{{loading && list.length === 0}}">
    <view class="card">
      <view class="empty-state">
        <view class="empty-title">对账单加载中</view>
        <view class="empty-desc">正在按筛选条件查询数据</view>
        <button class="btn-plain" bindtap="refreshData" disabled="{{loading}}">刷新重试</button>
      </view>
    </view>
  </block>

  <block wx:elif="{{errorMessage && list.length === 0}}">
    <view class="card">
      <view class="empty-state">
        <view class="empty-title">对账单加载失败</view>
        <view class="empty-desc">{{errorMessage}}</view>
        <view class="cta-row">
          <button class="btn-primary cta-btn" bindtap="refreshData" disabled="{{loading || actionLoading}}">刷新重试</button>
          <button class="btn-plain cta-btn" bindtap="goDeliveries" disabled="{{loading || actionLoading}}">去签收列表</button>
        </view>
      </view>
    </view>
  </block>

  <block wx:elif="{{list.length === 0}}">
    <view class="card">
      <view class="empty-state">
        <view class="empty-title">暂无对账单</view>
        <view class="empty-desc">可调整日期范围后再次查询</view>
        <view class="cta-row">
          <button class="btn-primary cta-btn" bindtap="search" disabled="{{loading || actionLoading}}">重新查询</button>
          <button class="btn-plain cta-btn" bindtap="goDeliveries" disabled="{{loading || actionLoading}}">返回签收列表</button>
        </view>
      </view>
    </view>
  </block>

  <block wx:else>
    <view class="card alert-card" wx:if="{{errorMessage}}">
      <view class="sub-title">最近一次刷新失败：{{errorMessage}}</view>
      <button class="btn-plain mini-btn" bindtap="refreshData" disabled="{{loading || actionLoading}}">刷新重试</button>
    </view>
    <view class="card item" wx:for="{{list}}" wx:key="id" bindtap="goDetail" data-id="{{item.id}}">
      <view class="row">
        <text class="label">账期</text>
        <text class="value">{{item.period_text}}</text>
      </view>
      <view class="row">
        <text class="label">金额</text>
        <text class="value">{{item.currency}} {{item.total_amount_text}}</text>
      </view>
      <view class="row">
        <text class="label">状态</text>
        <text class="value {{item.status === 'CONFIRMED' ? 'status-ok' : 'status-pending'}}">{{item.status}}</text>
      </view>
      <view class="more">查看详情 ></view>
    </view>
  </block>
</view>
